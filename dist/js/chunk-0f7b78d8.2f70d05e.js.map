{"version":3,"sources":["webpack:///./src/types/Auth.ts","webpack:///./src/mixins/FormValidator.ts","webpack:///./src/assets/img/doctor/pesod_logo_doctor.png","webpack:///./src/types/Doctor.ts","webpack:///./src/views/ForDoctor/Login.vue?3fca","webpack:///./src/views/ForDoctor/Login.vue","webpack:///./src/views/ForDoctor/Login.vue?426c","webpack:///./src/views/ForDoctor/Login.vue?d2ba"],"names":["useAuth","userType","TOKEN_KEYS","customer","doctor","client","getUUID","get","data","console","log","sendSignupEmail","formData","post","activateAccount","token","registerProfile","registrationUrl","formDataCopy","address","street","building","put","getToken","d","window","localStorage","getItem","JSON","parse","createToken","postData","storeToken","setItem","stringify","removeToken","removeItem","getUserId","id","getProfile","userId","storeProfile","getProfileFromStorage","removeProfile","signup","required","v","getRegexpTester","pattern","errorMessage","test","module","exports","useDoctors","doctors","fetchDoctors","getDoctor","class","src","alt","xmlns","viewBox","fill","fill-rule","clip-rule","disabled","loading","ref","method","onLogin","loginError","label","type","autocomplete","email","rules","formRequired","password","components","setup","router","form","setLoginError","message","value","setTimeout","event","isValid","checkValidity","alert","push","name","response","status","render","__scopeId"],"mappings":"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","file":"js/chunk-0f7b78d8.2f70d05e.js","sourcesContent":["import useAxios from '@/types/Axios';\n\nimport { ILogin, ISignup, ICustomer, IPrescript, IToken, IRegistration } from '@/types/Interfaces';\nimport { computed, ComputedRef, withDirectives, WritableComputedRef } from 'vue';\nimport { cloneDeep, clone, runInContext, words } from \"lodash\";\n\n\nexport default function useAuth (userType = 'customer') {\n  const TOKEN_KEYS: { [key: string]: string } = {\n    customer: 'customer_token',\n    doctor: 'doctor_token'\n  }\n  const {\n    client\n  } = useAxios(userType);\n\n  const getUUID = async () => {\n    const {data} = await client.get('/uuid/')\n    console.log(data)\n    return data;\n  }\n  \n  const sendSignupEmail = async (formData: any) => {\n    const {data} = await client.post('/customer_pre_create/', formData);\n    console.log(data);\n    return data;  \n  };\n  const activateAccount = async (token: string) => {\n    const {data} = await client.get(`/customer_activator/${token}`);\n    console.log(data)\n    return data;  \n  };\n  const registerProfile = async (registrationUrl: string, formData: IRegistration) => {\n    const formDataCopy: any = cloneDeep(formData);\n    \n    formDataCopy.address = `${formDataCopy.street}${formDataCopy.building}`;\n    delete formDataCopy.street;\n    delete formDataCopy.building;\n    const {data} = await client.put(registrationUrl, formDataCopy);\n    console.log(data)\n    return data;\n  }\n  \n  const getToken = () => {\n    console.log('getting token from ' + TOKEN_KEYS[userType])\n    const d = window.localStorage.getItem(TOKEN_KEYS[userType])\n    if (d == null) return;\n    return JSON.parse(d);\n  }\n  const createToken = async (postData: ILogin) => {\n    const {data} = await client.post('/auth/jwt/create/', postData);\n    // console.log(data)\n    return data;\n    // window.localStorage.setItem('token', JSON.stringify(data));    \n  };\n  \n  const storeToken = (token: IToken) => {\n    console.log('storeing token' + TOKEN_KEYS[userType])\n    window.localStorage.setItem(TOKEN_KEYS[userType], JSON.stringify(token))\n  }\n  \n  const removeToken = () => {\n    window.localStorage.removeItem(TOKEN_KEYS[userType]);\n  };\n  \n  const getUserId = async () => {\n    const {data} = await client.get('/auth/users/me/')\n    return data.id;\n  };\n  \n  const getProfile = async (userId: number) => {\n    const {data} = await client.get(`/auth/users/${userId}/`);\n    console.log(data)\n    return data;\n  };\n  \n  const storeProfile = (data: any) => {\n    window.localStorage.setItem('profile', JSON.stringify(data))\n  }\n  const getProfileFromStorage = () => {\n    const data = window.localStorage.getItem('profile')\n  }\n  const removeProfile = () => {\n    window.localStorage.removeItem('profile')\n  }\n  \n  \n  const signup = async (postData: ISignup) => {\n    const { data } = await client.post(\n      `/signup/`, postData\n    );\n  };\n  return {\n    sendSignupEmail,\n    activateAccount,\n    registerProfile,\n    createToken,\n    storeToken,\n    getToken,\n    removeToken,\n    getUserId,\n    getProfile,\n    getProfileFromStorage,\n    removeProfile,\n    storeProfile,\n    signup,\n    getUUID\n  }\n}","\nconst required = (v: any) => {\n  if (typeof v === 'string') {\n    return v ? null : '必須項目です。'\n  }\n};\nconst getRegexpTester = (pattern: RegExp, errorMessage: string) => {\n  return (v: any) => {\n    return pattern.test(v) ? null : errorMessage;\n  }\n}\n\nexport {\n  required as formRequired,\n  getRegexpTester\n}","module.exports = __webpack_public_path__ + \"img/pesod_logo_doctor.dad27519.png\";","import { ref, computed } from 'vue';\nimport { IDoctor } from './Interfaces';\nimport useAxios from './Axios';\n\n\n\n\n// const myDoctor = computed(() => {\n//   return doctors.value.find(d => d.id===1);\n// })\nexport default function useDoctors(userType = 'customer') {\n  const {\n    client\n  } = useAxios(userType)\n  const doctors = ref<IDoctor[]>([]);\n  const doctor = ref<IDoctor | null>(null);\n  const fetchDoctors = async (): Promise<IDoctor[]> => {\n    const { data } = await client.get('/doctors/');\n    return data\n  }\n  \n  const getDoctor = async (id: number): Promise<IDoctor> => {\n    const { data } = await client.get(`/doctor/${id}`);\n    return data;\n  }\n  return {\n    // myDoctor,\n    doctor,\n    doctors,\n    getDoctor,\n    fetchDoctors\n  }\n}","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Login.vue?vue&type=style&index=0&id=a4d8c5ce&scoped=true&lang=css\"","<template>\n  \n  <div class=\"container h-screen w-screen table-cell align-middle\">\n    <div class=\"mx-auto rounded p-5 w-80\">\n      <img\n        src=\"@/assets/img/doctor/pesod_logo_doctor.png\"\n        alt=\"\"\n        class=\"mb-5\"\n      >\n      <form\n        class=\" \"\n        :disabled=\"loading\"\n        ref=\"from\"\n        method=\"post\"\n        @submit.prevent=\"onLogin\"\n      >\n        <div\n        v-if=\"loginError != ''\"\n        class=\"mb-5 text-red-600\"\n      >\n        {{ loginError }}\n      </div>\n      <p-input\n        class=\"mb-10\"\n        label=\"メールアドレス\"\n        id=\"email\"\n        type=\"email\"\n        :required=\"true\"\n        autocomplete=\"email\"\n        v-model=\"formData.email\"\n        :rules=\"[formRequired]\"\n      >\n      </p-input>\n      \n      <p-input\n        class=\"mb-12\"\n        label=\"パスワード\"\n        autocomplete=\"current-password\"\n        id=\"password\"\n        type=\"password\"\n        v-model=\"formData.password\"\n        :rules=\"[formRequired]\"\n      >\n      </p-input>\n      \n      <div\n        class=\"text-center\"\n      >\n        <button\n          :disabled=\"loading\"\n          type=\"submit\"\n          class=\"primary mb-10 w-72 sm:block sm:w-full\"\n        >\n          <div class=\"inline-block\">\n            ログイン\n          </div>\n          <svg\n          class=\" w-6 h-6 float-right\"\n          xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n            <path fill-rule=\"evenodd\" d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\" clip-rule=\"evenodd\" />\n          </svg>\n        </button>\n        <div>\n          <a class=\"cursor-pointer \">パスワードをお忘れの方はこちら</a>\n        </div>\n      </div>\n      </form>\n    </div>\n    \n  </div>\n</template>\n<style scoped>\n  .container {\n    background-image: url(/img/top_bk_PC.png);\n    background-size: contain;\n  }\n</style>\n<script lang=\"ts\">\nimport { defineComponent, ref, onMounted, isProxy } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ILogin } from '@/types/Interfaces';\n\nimport {formRequired} from '@/mixins/FormValidator';\n\nimport useAuth from '@/types/Auth';\nimport useDoctor from '@/types/Doctor';\nimport { remove } from 'lodash';\n\nexport default defineComponent({\n  components: {\n  },\n  setup() {\n    const router = useRouter();\n\n    const {\n      createToken,\n      storeToken,\n      removeToken,\n      getUserId,\n      getProfile,\n      storeProfile,\n      removeProfile,\n      getProfileFromStorage\n    } = useAuth('doctor');\n    \n    const {\n      getDoctor\n    } = useDoctor('doctor');\n\n    const formData = ref<ILogin>({\n      email: '',\n      password: '' \n    });\n    \n    const form = ref<HTMLFormElement | null>(null);\n\n    const loginError = ref<string>('');\n    \n    const setLoginError = (message: string) => {\n      loginError.value = message;\n      window.setTimeout(() => {\n        loginError.value = '';\n      }, 5000);  \n    };\n    \n    onMounted(() => {\n      removeToken()\n    });\n\n    const loading = ref(false);\n\n    const onLogin = async (event: Event) => {\n      // validate\n      if (form.value) {\n        const isValid = form.value.checkValidity();\n        if (!isValid) {\n          alert('not vaida')\n          return;\n        }\n      }\n      try {\n        loading.value = true;\n        const token = await createToken(formData.value);\n        storeToken(token);\n        const userId = await getUserId();\n        // const profile = await getPro(userId);\n        // console.log(profile)\n        // storeProfile(profile)\n\n        router.push({ name: 'DoctorDashboard' }) ;\n      } catch (err) {\n        console.log(err)\n        if (err.response) {\n          const { status, data } = err.response;\n          console.log(data)\n          if (status >= 400 && status < 500) {\n            setLoginError('ログインに失敗しました。')\n          } else {\n            setLoginError(JSON.stringify(data))\n          }\n          // formData.value = {\n          //   email: '',\n          //   password: ''\n          // }\n        } else {\n          // network error or timeout\n          setLoginError('ネットワークエラー')\n        }\n        \n      }\n      loading.value = false;\n      \n    };\n    return {\n      loading,\n      form,\n      formRequired,\n      formData,\n      loginError,\n      // formValid,\n      onLogin\n    };\n  }\n})\n</script>","\nimport { defineComponent, ref, onMounted, isProxy } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ILogin } from '@/types/Interfaces';\n\nimport {formRequired} from '@/mixins/FormValidator';\n\nimport useAuth from '@/types/Auth';\nimport useDoctor from '@/types/Doctor';\nimport { remove } from 'lodash';\n\nexport default defineComponent({\n  components: {\n  },\n  setup() {\n    const router = useRouter();\n\n    const {\n      createToken,\n      storeToken,\n      removeToken,\n      getUserId,\n      getProfile,\n      storeProfile,\n      removeProfile,\n      getProfileFromStorage\n    } = useAuth('doctor');\n    \n    const {\n      getDoctor\n    } = useDoctor('doctor');\n\n    const formData = ref<ILogin>({\n      email: '',\n      password: '' \n    });\n    \n    const form = ref<HTMLFormElement | null>(null);\n\n    const loginError = ref<string>('');\n    \n    const setLoginError = (message: string) => {\n      loginError.value = message;\n      window.setTimeout(() => {\n        loginError.value = '';\n      }, 5000);  \n    };\n    \n    onMounted(() => {\n      removeToken()\n    });\n\n    const loading = ref(false);\n\n    const onLogin = async (event: Event) => {\n      // validate\n      if (form.value) {\n        const isValid = form.value.checkValidity();\n        if (!isValid) {\n          alert('not vaida')\n          return;\n        }\n      }\n      try {\n        loading.value = true;\n        const token = await createToken(formData.value);\n        storeToken(token);\n        const userId = await getUserId();\n        // const profile = await getPro(userId);\n        // console.log(profile)\n        // storeProfile(profile)\n\n        router.push({ name: 'DoctorDashboard' }) ;\n      } catch (err) {\n        console.log(err)\n        if (err.response) {\n          const { status, data } = err.response;\n          console.log(data)\n          if (status >= 400 && status < 500) {\n            setLoginError('ログインに失敗しました。')\n          } else {\n            setLoginError(JSON.stringify(data))\n          }\n          // formData.value = {\n          //   email: '',\n          //   password: ''\n          // }\n        } else {\n          // network error or timeout\n          setLoginError('ネットワークエラー')\n        }\n        \n      }\n      loading.value = false;\n      \n    };\n    return {\n      loading,\n      form,\n      formRequired,\n      formData,\n      loginError,\n      // formValid,\n      onLogin\n    };\n  }\n})\n","import { render } from \"./Login.vue?vue&type=template&id=a4d8c5ce&scoped=true\"\nimport script from \"./Login.vue?vue&type=script&lang=ts\"\nexport * from \"./Login.vue?vue&type=script&lang=ts\"\n\nimport \"./Login.vue?vue&type=style&index=0&id=a4d8c5ce&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-a4d8c5ce\"\n\nexport default script"],"sourceRoot":""}