(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["DoctorDetailChat"],{"323b":function(e,t,c){},"53f3":function(e,t,c){"use strict";c.r(t);var r=c("7a23"),a=Object(r["withScopeId"])("data-v-eb11058c");Object(r["pushScopeId"])("data-v-eb11058c");var n={class:""},o=Object(r["createVNode"])("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1),s=Object(r["createVNode"])("div",null," 診察ルーム ",-1),l={ref:"messageArea",class:"relative overflow-y-auto flex-grow "},u={class:"w-full flex items-center"},i={class:"flex items-center text-sm ml-2"},d={key:1,style:{height:"30px",width:"30px"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},p=Object(r["createVNode"])("path",{"fill-rule":"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z","clip-rule":"evenodd"},null,-1),b={class:"px-2"},m={class:"absolute w-full space-y-4 pb-5"},v={key:0,class:"bg-gray-100 text-center py-3"},O=Object(r["createVNode"])("div",{class:"text-lg"},"診察は終了です。",-1),g=Object(r["createTextVNode"])("「"),j=Object(r["createTextVNode"])("」へ戻る "),f={key:2,style:{height:"100px"},class:"relative overflow-y-scroll"},k={key:0,class:"absolute w-full"},h={key:1};Object(r["popScopeId"])();var y=a((function(e,t,c,y,w,x){var B=Object(r["resolveComponent"])("page-title"),N=Object(r["resolveComponent"])("chat-date-label"),C=Object(r["resolveComponent"])("chat-message-card"),S=Object(r["resolveComponent"])("chat-form"),V=Object(r["resolveComponent"])("base-layout");return e.myPrescript?(Object(r["openBlock"])(),Object(r["createBlock"])(V,{key:0},{title:a((function(){return[Object(r["createVNode"])("div",n,[(Object(r["openBlock"])(),Object(r["createBlock"])("svg",{onClick:t[1]||(t[1]=function(){e.router.push({name:"DiagnosticTop"})}),xmlns:"http://www.w3.org/2000/svg",class:"absolute h-6 w-6 cursor-pointer",viewBox:"0 0 20 20",fill:"currentColor"},[o])),s])]})),default:a((function(){return[Object(r["createVNode"])("div",l,[Object(r["createVNode"])(B,{class:"mb-3 text-left flex",style:{height:"40px"}},{default:a((function(){return[Object(r["createVNode"])("div",u,[Object(r["createVNode"])("div",i,[e.doctor.image?(Object(r["openBlock"])(),Object(r["createBlock"])("img",{key:0,src:e.doctor.image,alt:"doctor",class:"rounded-full",style:{height:"30px",width:"30px"}},null,8,["src"])):(Object(r["openBlock"])(),Object(r["createBlock"])("svg",d,[p])),Object(r["createVNode"])("div",b,Object(r["toDisplayString"])(e.doctor.first_name)+" "+Object(r["toDisplayString"])(e.doctor.last_name),1)])])]})),_:1}),Object(r["createVNode"])("div",m,[e.chatLogs.length>0?(Object(r["openBlock"])(),Object(r["createBlock"])(N,{key:0,dateStr:e.chatLogs[0].created_at},null,8,["dateStr"])):Object(r["createCommentVNode"])("",!0),(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.chatLogs,(function(t,c){return Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],{key:c},[c>1&&e.getDate(e.chatLogs[c].created_at)!==e.getDate(e.chatLogs[c-1].created_at)?(Object(r["openBlock"])(),Object(r["createBlock"])(N,{key:0,dateStr:t.created_at},null,8,["dateStr"])):Object(r["createCommentVNode"])("",!0),Object(r["createVNode"])(C,{chatLog:t,isMyMessage:t.speaker===e.myPrescript.customer.id},null,8,["chatLog","isMyMessage"])],64)})),128))])],512),e.myPrescript.prescript_products.length&&e.myPrescript.status>=4?(Object(r["openBlock"])(),Object(r["createBlock"])("div",v,[O,Object(r["createVNode"])("div",null,[g,Object(r["createVNode"])("span",{class:"text-blue-400 cursor-pointer",onClick:t[2]||(t[2]=function(t){return e.router.push({name:"DiagnosticTop"})})},"お手続きメニュー"),j])])):Object(r["createCommentVNode"])("",!0),3==e.myPrescript.status?(Object(r["openBlock"])(),Object(r["createBlock"])(S,{key:1,modelValue:e.message,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.message=t}),onSend:e.onSendMessage},{menu:a((function(){return[Object(r["createVNode"])("button",{onClick:t[3]||(t[3]=function(){return e.onAccept&&e.onAccept.apply(e,arguments)}),class:"rounded border text-xs"}," はい "),Object(r["createVNode"])("button",{onClick:t[4]||(t[4]=function(){return e.onDeny&&e.onDeny.apply(e,arguments)}),class:"rounded border text-xs"}," いいえ "),Object(r["createVNode"])("button",{onClick:t[5]||(t[5]=function(t){return e.sendMessage("承知しました")}),class:"rounded border text-xs"}," 承知しました ")]})),_:1},8,["modelValue","onSend"])):Object(r["createCommentVNode"])("",!0),e.showMessageTemplates?(Object(r["openBlock"])(),Object(r["createBlock"])("div",f,[e.customerMessageTemplates.length?(Object(r["openBlock"])(),Object(r["createBlock"])("ul",k,[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.customerMessageTemplates,(function(t,c){return Object(r["openBlock"])(),Object(r["createBlock"])("li",{onClick:function(c){return e.onSelectTemplate(t)},key:c,class:"border-b border-gray-100 hover:bg-gray-50"},Object(r["toDisplayString"])(t.message),9,["onClick"])})),128))])):(Object(r["openBlock"])(),Object(r["createBlock"])("div",h," テンプレートがありません。 "))])):Object(r["createCommentVNode"])("",!0)]})),_:1})):Object(r["createCommentVNode"])("",!0)})),w=(c("99af"),c("caad"),c("ac1f"),c("2532"),c("5319"),c("498a"),c("96cf"),c("1da1")),x=c("6c02"),B=c("472c"),N=c("6834"),C=c("e59e"),S=c("0b48"),V=c("da56"),M=c("382a"),D=c("c1df"),L=c.n(D),_=c("498b"),T=Object(r["defineComponent"])({components:{ChatMessageCard:C["a"],ChatForm:S["a"],ChatDateLabel:_["a"]},props:{doctor:{type:Object}},setup:function(e,t){Object(x["c"])();var c=Object(x["d"])(),a=Object(M["a"])(),n=a.getToken,o=Object(V["a"])(),s=o.myPrescript,l=o.getPrescript,u=o.acceptPrescriptProducts,i=o.deletePrescriptProducts,d=Object(B["a"])(),p=d.chatLogs,b=d.fetchDoctorChatLogs,m=d.fetchCustomerMessageTemplates,v=Object(N["a"])(),O=v.WS_BASE_URL,g=v.connection,j=(v.connect,v.close),f=v.messageArea,k=v.scrollDown,h=v.wsState,y=v.wsStateStr,C=v.message,S=v.prepareWs,D=Object(r["ref"])([]),_=Object(r["ref"])(!1),T=function(e){_.value=!1},P=function(e){if(null!=s.value&&null!=g.value&&g.value.readyState===g.value.OPEN){var t={uuid:s.value.customer.uuid,message:e};g.value.send(JSON.stringify(t))}},R=function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(){var t,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=s.value){e.next=2;break}return e.abrupt("return");case 2:if(null===(t=s.value.prescript_products)||void 0===t||!t.length){e.next=9;break}return e.next=5,u();case 5:if(e.sent,null!=g.value){e.next=8;break}return e.abrupt("return");case 8:g.value.readyState==g.value.OPEN&&(c={uuid:s.value.customer.uuid,situation:"end"},g.value.send(JSON.stringify(c)));case 9:return e.next=11,l();case 11:s.value=e.sent,P("はい");case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=s.value){e.next=2;break}return e.abrupt("return");case 2:if(null===(t=s.value.prescript_products)||void 0===t||!t.length){e.next=6;break}return e.next=5,i(s.value.prescript_no);case 5:e.sent;case 6:return e.next=8,l();case 8:s.value=e.sent,P("いいえ");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){C.value.trim()&&(P(C.value),C.value="")},I=function(){var e=Object(w["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.message.includes("table")){e.next=4;break}return e.next=3,l();case 3:s.value=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(r["onMounted"])(Object(w["a"])(regeneratorRuntime.mark((function e(){var t,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:return s.value=e.sent,e.next=5,m();case 5:if(D.value=e.sent,null!=s.value){e.next=8;break}return e.abrupt("return");case 8:return 3!=s.value.status&&c.replace({name:"DiagnosticTop"}),e.next=11,b(s.value.prescript_no);case 11:p.value=e.sent,a="".concat(O,"/chat/doctor/").concat(null===(t=s.value)||void 0===t?void 0:t.customer.uuid,"/?token=").concat(null===(r=n())||void 0===r?void 0:r.access),S(a,p,I),window.setTimeout((function(){k()}),100);case 15:case"end":return e.stop()}}),e)})))),Object(r["onBeforeUnmount"])((function(){j()}));var J=function(e){return L()(e).format("yyyy/MM/DD")};return{sendMessage:P,myPrescript:s,connection:g,router:c,messageArea:f,message:C,chatLogs:p,onSendMessage:F,wsState:h,wsStateStr:y,getDate:J,onSelectTemplate:T,customerMessageTemplates:D,showMessageTemplates:_,onDeny:A,onAccept:R}}});c("8a8a");T.render=y,T.__scopeId="data-v-eb11058c";t["default"]=T},"8a8a":function(e,t,c){"use strict";c("323b")}}]);
//# sourceMappingURL=DoctorDetailChat.1177c911.js.map