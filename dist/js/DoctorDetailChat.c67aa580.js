(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["DoctorDetailChat"],{"53f3":function(e,t,r){"use strict";r.r(t);var n=r("7a23"),c=Object(n["K"])("data-v-41209d0e");Object(n["w"])("data-v-41209d0e");var a={class:""},s=Object(n["h"])("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1),u=Object(n["h"])("div",null," 診察ルーム ",-1),o={ref:"messageArea",class:"relative overflow-y-auto flex-grow "},l={class:"flex items-center"},i=Object(n["h"])("div",null,"診察室",-1),d={class:"flex items-center text-sm ml-2"},b=Object(n["h"])("div",null,"[",-1),p={key:1,style:{height:"30px",width:"30px"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},O=Object(n["h"])("path",{"fill-rule":"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z","clip-rule":"evenodd"},null,-1),j={class:"px-2"},v=Object(n["h"])("div",null,"]",-1),f={class:"absolute w-full space-y-4 pb-5"},g={key:0,class:"bg-gray-100 text-center py-3"},h=Object(n["h"])("div",{class:"text-lg"},"診察は終了です。",-1),m=Object(n["g"])("「"),w=Object(n["g"])("」へ戻る "),y={key:2,style:{height:"100px"},class:"relative overflow-y-scroll"},x={key:0,class:"absolute w-full"},k={key:1};Object(n["u"])();var S=c((function(e,t,r,S,D,M){var _=Object(n["B"])("ws-state-marker"),C=Object(n["B"])("page-title"),L=Object(n["B"])("chat-date-label"),P=Object(n["B"])("chat-message-card"),R=Object(n["B"])("chat-form"),T=Object(n["B"])("base-layout");return e.myPrescript?(Object(n["t"])(),Object(n["d"])(T,{key:0},{title:c((function(){return[Object(n["h"])("div",a,[(Object(n["t"])(),Object(n["d"])("svg",{onClick:t[1]||(t[1]=function(){e.router.push({name:"DiagnosticTop"})}),xmlns:"http://www.w3.org/2000/svg",class:"absolute h-6 w-6 cursor-pointer",viewBox:"0 0 20 20",fill:"currentColor"},[s])),u])]})),default:c((function(){return[Object(n["h"])("div",o,[Object(n["h"])(C,{class:"mb-3"},{default:c((function(){return[Object(n["h"])("div",l,[i,Object(n["h"])("div",d,[b,e.doctor.image?(Object(n["t"])(),Object(n["d"])("img",{key:0,src:e.doctor.image,alt:"doctor",style:{height:"30px",width:"30px"}},null,8,["src"])):(Object(n["t"])(),Object(n["d"])("svg",p,[O])),Object(n["h"])("div",j,Object(n["D"])(e.doctor.first_name)+" "+Object(n["D"])(e.doctor.last_name),1),v])]),Object(n["h"])(_,{wsState:e.wsState},null,8,["wsState"])]})),_:1}),Object(n["h"])("div",f,[e.chatLogs.length>0?(Object(n["t"])(),Object(n["d"])(L,{key:0,dateStr:e.chatLogs[0].created_at},null,8,["dateStr"])):Object(n["e"])("",!0),(Object(n["t"])(!0),Object(n["d"])(n["a"],null,Object(n["z"])(e.chatLogs,(function(t,r){return Object(n["t"])(),Object(n["d"])(n["a"],{key:r},[r>1&&e.getDate(e.chatLogs[r].created_at)!==e.getDate(e.chatLogs[r-1].created_at)?(Object(n["t"])(),Object(n["d"])(L,{key:0,dateStr:t.created_at},null,8,["dateStr"])):Object(n["e"])("",!0),Object(n["h"])(P,{chatLog:t,isMyMessage:t.speaker===e.myPrescript.customer.id},null,8,["chatLog","isMyMessage"])],64)})),128))])],512),e.myPrescript.prescript_products.length&&e.myPrescript.status>=4?(Object(n["t"])(),Object(n["d"])("div",g,[h,Object(n["h"])("div",null,[m,Object(n["h"])("span",{class:"text-blue-400 cursor-pointer",onClick:t[2]||(t[2]=function(t){return e.router.push({name:"DiagnosticTop"})})},"お手続きメニュー"),w])])):Object(n["e"])("",!0),3==e.myPrescript.status?(Object(n["t"])(),Object(n["d"])(R,{key:1,modelValue:e.message,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.message=t}),onSend:e.onSendMessage},{menu:c((function(){return[Object(n["h"])("button",{onClick:t[3]||(t[3]=function(){return e.onAccept&&e.onAccept.apply(e,arguments)}),class:"rounded border text-sm "}," はい "),Object(n["h"])("button",{onClick:t[4]||(t[4]=function(){return e.onDeny&&e.onDeny.apply(e,arguments)}),class:"rounded border text-sm"}," いいえ "),Object(n["h"])("button",{onClick:t[5]||(t[5]=function(t){return e.sendMessage("承知しました")}),class:"rounded border text-sm"}," 承知しました ")]})),_:1},8,["modelValue","onSend"])):Object(n["e"])("",!0),e.showMessageTemplates?(Object(n["t"])(),Object(n["d"])("div",y,[e.customerMessageTemplates.length?(Object(n["t"])(),Object(n["d"])("ul",x,[(Object(n["t"])(!0),Object(n["d"])(n["a"],null,Object(n["z"])(e.customerMessageTemplates,(function(t,r){return Object(n["t"])(),Object(n["d"])("li",{onClick:function(r){return e.onSelectTemplate(t)},key:r,class:"border-b border-gray-100 hover:bg-gray-50"},Object(n["D"])(t.message),9,["onClick"])})),128))])):(Object(n["t"])(),Object(n["d"])("div",k," テンプレートがありません。 "))])):Object(n["e"])("",!0)]})),_:1})):Object(n["e"])("",!0)})),D=(r("99af"),r("caad"),r("ac1f"),r("2532"),r("5319"),r("498a"),r("96cf"),r("1da1")),M=r("6c02"),_=r("472c"),C=r("8f75"),L=r("6834"),P=r("e59e"),R=r("0b48"),T=r("da56"),B=r("382a"),A=r("feb7"),z=r("c1df"),J=r.n(z),V=r("498b"),W=Object(n["i"])({components:{ChatMessageCard:P["a"],ChatForm:R["a"],WsStateMarker:A["a"],ChatDateLabel:V["a"]},props:{doctor:{type:Object}},setup:function(e,t){Object(M["c"])();var r=Object(M["d"])(),c=Object(B["a"])(),a=c.getToken,s=Object(T["a"])(),u=s.myPrescript,o=s.getPrescript,l=s.acceptPrescriptProducts,i=s.deletePrescriptProducts,d=Object(C["a"])(),b=(d.doctors,d.fetchDoctors,Object(_["a"])()),p=b.chatLogs,O=b.fetchDoctorChatLogs,j=b.fetchCustomerMessageTemplates,v=Object(L["a"])(),f=v.WS_BASE_URL,g=v.connection,h=(v.connect,v.close),m=v.messageArea,w=v.scrollDown,y=v.wsState,x=v.wsStateStr,k=v.message,S=v.prepareWs,P=Object(n["y"])([]),R=Object(n["y"])(!1),A=function(e){R.value=!1},z=function(e){if(null!=u.value&&null!=g.value&&g.value.readyState===g.value.OPEN){var t={uuid:u.value.customer.uuid,message:e};g.value.send(JSON.stringify(t))}},V=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=u.value){e.next=2;break}return e.abrupt("return");case 2:if(null===(t=u.value.prescript_products)||void 0===t||!t.length){e.next=6;break}return e.next=5,l();case 5:e.sent;case 6:return e.next=8,o();case 8:u.value=e.sent,z("はい");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=u.value){e.next=2;break}return e.abrupt("return");case 2:if(null===(t=u.value.prescript_products)||void 0===t||!t.length){e.next=6;break}return e.next=5,i(u.value.prescript_no);case 5:e.sent;case 6:return e.next=8,o();case 8:u.value=e.sent,z("いいえ");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){k.value.trim()&&(z(k.value),k.value="")},N=function(){var e=Object(D["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.message.includes("table")){e.next=4;break}return e.next=3,o();case 3:u.value=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(n["q"])(Object(D["a"])(regeneratorRuntime.mark((function e(){var t,n,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o();case 2:return u.value=e.sent,e.next=5,j();case 5:if(P.value=e.sent,null!=u.value){e.next=8;break}return e.abrupt("return");case 8:return 3!=u.value.status&&r.replace({name:"DiagnosticTop"}),e.prev=9,e.next=12,O(u.value.id);case 12:c=e.sent,p.value=c,e.next=20;break;case 16:return e.prev=16,e.t0=e["catch"](9),console.error(e.t0.response),e.abrupt("return");case 20:s="".concat(f,"/chat/doctor/").concat(null===(t=u.value)||void 0===t?void 0:t.customer.uuid,"/?token=").concat(null===(n=a())||void 0===n?void 0:n.access),S(s,p,N),window.setTimeout((function(){w()}),100);case 23:case"end":return e.stop()}}),e,null,[[9,16]])})))),Object(n["o"])((function(){h()}));var U=function(e){return J()(e).format("yyyy/MM/DD")};return{sendMessage:z,myPrescript:u,connection:g,router:r,messageArea:m,message:k,chatLogs:p,onSendMessage:E,wsState:y,wsStateStr:x,getDate:U,onSelectTemplate:A,customerMessageTemplates:P,showMessageTemplates:R,onDeny:W,onAccept:V}}});r("58f1");W.render=S,W.__scopeId="data-v-41209d0e";t["default"]=W},"58f1":function(e,t,r){"use strict";r("ca72")},"8f75":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("96cf");var n=r("1da1"),c=r("7a23"),a=r("2e44"),s=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a["a"].get("/doctors/");case 2:return t=e.sent,r=t.data,n=r.results,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a["a"].get("/doctor/".concat(t));case 2:return r=e.sent,n=r.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function o(){var e=Object(c["y"])([]),t=Object(c["y"])(null);return{doctor:t,doctors:e,getDoctor:u,fetchDoctors:s}}},ca72:function(e,t,r){}}]);
//# sourceMappingURL=DoctorDetailChat.c67aa580.js.map